# Galaxy World Model (Pure Data)

Status: November 20, 2025 — the ECS layer has been removed. The galaxy lives as plain data on `game-state` and is shared by rendering, selection, and the Reactified UI.

## Top‑Level Keys on `game-state`

```clojure
{:stars                {id star-map}
 :hyperlanes           [hyperlane-map ...]
 :neighbors-by-star-id {star-id [{:neighbor-id ... :hyperlane hyperlane-map} ...]}
 :next-star-id         long   ; last issued star id
 :next-hyperlane-id    long   ; last issued hyperlane id
 ... ;; existing camera/ui/metrics keys unchanged
}
```

`silent-king.state` exposes helpers: `stars`, `star-seq`, `star-by-id`, `hyperlanes`, `neighbors-by-star-id`, `add-star!`, `add-hyperlane!`, `set-world!`, `reset-world-ids!`.

## Star Shape

```clojure
{:id             long
 :x              double
 :y              double
 :size           double       ; base sprite size before zoom
 :density        double       ; 0..1, drives visuals
 :sprite-path    string
 :rotation-speed double}      ; radians/sec (scaled in rendering)
```

Stars are generated by `silent-king.galaxy/generate-galaxy` (pure). `generate-galaxy!` writes the resulting map to `:stars`, clears hyperlanes, and resets the hyperlane ID counter.

## Hyperlane Shape

```clojure
{:id               long
 :from-id          long
 :to-id            long
 :base-width       double
 :color-start      long
 :color-end        long
 :glow-color       long
 :animation-offset double}
```

`silent-king.hyperlanes/generate-hyperlanes` (pure) runs Delaunay over `:stars` and returns `:hyperlanes`, an adjacency map, and the next ID. `generate-hyperlanes!` persists both the vector and `:neighbors-by-star-id`.

## Selection and UI

- Selection stores only the star id (`[:selection :star-id]`). Detail views resolve stars via `state/star-by-id` and connections via `:neighbors-by-star-id`.
- Rendering (`silent-king.core/draw-frame`) iterates `state/star-seq` and `state/hyperlanes`, with hyperlanes drawn before stars.
- The minimap and performance overlay derive their props from the same pure collections; no component queries are needed.

## Determinism for Tests

- ID counters start at 1 and are resettable with `state/reset-world-ids!`.
- Test helpers in `test/silent_king/test_fixtures.clj` add stars/hyperlanes and recompute adjacency for small worlds.

This document supersedes the old ECS-centric notes (`WidgetToolkit.md`, etc.) for world modeling.
